"use strict";(()=>{var e={};e.id=808,e.ids=[808],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},84629:e=>{e.exports=import("@libsql/client")},72712:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>u,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>c,staticGenerationAsyncStorage:()=>m});var n=t(49303),o=t(88716),a=t(60670),i=t(65212),d=e([i]);i=(d.then?(await d)():d)[0];let l=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/groups/[id]/members/route",pathname:"/api/groups/[id]/members",filename:"route",bundlePath:"app/api/groups/[id]/members/route"},resolvedPagePath:"C:\\Users\\denis\\famiglia-budget\\src\\app\\api\\groups\\[id]\\members\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:c}=l,f="/api/groups/[id]/members/route";function u(){return(0,a.patchFetch)({serverHooks:c,staticGenerationAsyncStorage:m})}s()}catch(e){s(e)}})},65212:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{DELETE:()=>g,GET:()=>m,POST:()=>c,PUT:()=>f});var n=t(87070),o=t(75571),a=t(90469),i=t(63737),d=t(57745),u=t(46335),l=t(95456),p=e([a,l]);async function m(e,{params:r}){try{let e=await (0,o.getServerSession)(l.L);if(!e?.user?.id)return n.NextResponse.json({error:"Unauthorized"},{status:401});let{id:t}=await r,[s]=await a.db.select().from(i.groups).innerJoin(i.groupMembers,(0,d.xD)((0,d.eq)(i.groups.id,i.groupMembers.groupId),(0,d.eq)(i.groupMembers.userId,e.user.id))).where((0,d.eq)(i.groups.id,t)).limit(1);if(!s)return n.NextResponse.json({error:"Group not found"},{status:404});let u=await a.db.select().from(i.groupMembers).where((0,d.eq)(i.groupMembers.groupId,t));return n.NextResponse.json(u)}catch(e){return console.error("Error fetching members:",e),n.NextResponse.json({error:"Internal error"},{status:500})}}async function c(e,{params:r}){try{let t=await (0,o.getServerSession)(l.L);if(!t?.user?.id)return n.NextResponse.json({error:"Unauthorized"},{status:401});let{id:s}=await r,{name:p,quotaPercent:m}=await e.json();if(!p||void 0===m)return n.NextResponse.json({error:"Name and quota required"},{status:400});let[c]=await a.db.select().from(i.groups).where((0,d.eq)(i.groups.id,s)).limit(1);if(!c||c.ownerId!==t.user.id)return n.NextResponse.json({error:"Forbidden"},{status:403});if((await a.db.select().from(i.groupMembers).where((0,d.eq)(i.groupMembers.groupId,s))).reduce((e,r)=>e+r.quotaPercent,0)+m>110)return n.NextResponse.json({error:"Total quota exceeds 110%"},{status:400});let f=(0,u.Z)();return await a.db.insert(i.groupMembers).values({id:f,groupId:s,userId:null,name:p,quotaPercent:m,createdAt:new Date}),n.NextResponse.json({id:f,name:p,quotaPercent:m})}catch(e){return console.error("Error creating member:",e),n.NextResponse.json({error:"Internal error"},{status:500})}}async function f(e,{params:r}){try{let t=await (0,o.getServerSession)(l.L);if(!t?.user?.id)return n.NextResponse.json({error:"Unauthorized"},{status:401});let{id:s}=await r,{memberId:u,name:p,quotaPercent:m}=await e.json(),[c]=await a.db.select().from(i.groups).where((0,d.eq)(i.groups.id,s)).limit(1);if(!c||c.ownerId!==t.user.id)return n.NextResponse.json({error:"Forbidden"},{status:403});let f=await a.db.select().from(i.groupMembers).where((0,d.eq)(i.groupMembers.groupId,s));if(!f.find(e=>e.id===u))return n.NextResponse.json({error:"Member not found"},{status:404});if(f.filter(e=>e.id!==u).reduce((e,r)=>e+r.quotaPercent,0)+m>110)return n.NextResponse.json({error:"Total quota exceeds 110%"},{status:400});return await a.db.update(i.groupMembers).set({name:p,quotaPercent:m}).where((0,d.eq)(i.groupMembers.id,u)),n.NextResponse.json({success:!0})}catch(e){return console.error("Error updating member:",e),n.NextResponse.json({error:"Internal error"},{status:500})}}async function g(e,{params:r}){try{let t=await (0,o.getServerSession)(l.L);if(!t?.user?.id)return n.NextResponse.json({error:"Unauthorized"},{status:401});let{id:s}=await r,{searchParams:u}=new URL(e.url),p=u.get("memberId"),[m]=await a.db.select().from(i.groups).where((0,d.eq)(i.groups.id,s)).limit(1);if(!m||m.ownerId!==t.user.id)return n.NextResponse.json({error:"Forbidden"},{status:403});return await a.db.delete(i.groupMembers).where((0,d.eq)(i.groupMembers.id,p)),n.NextResponse.json({success:!0})}catch(e){return console.error("Error deleting member:",e),n.NextResponse.json({error:"Internal error"},{status:500})}}[a,l]=p.then?(await p)():p,s()}catch(e){s(e)}})},90469:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.d(r,{db:()=>u});var n=t(84629),o=t(3122),a=t(63737),i=e([n,o]);[n,o]=i.then?(await i)():i;let d=(0,n.createClient)({url:process.env.TURSO_DATABASE_URL,authToken:process.env.TURSO_AUTH_TOKEN}),u=(0,o.t)(d,{schema:a});s()}catch(e){s(e)}})},63737:(e,r,t)=>{t.r(r),t.d(r,{expenseCategories:()=>p,expenseCategoriesRelations:()=>w,expensePayments:()=>f,expensePaymentsRelations:()=>h,groupMembers:()=>l,groupMembersRelations:()=>_,groups:()=>d,groupsRelations:()=>x,oneTimeExpenses:()=>c,oneTimeExpensesRelations:()=>b,payments:()=>g,paymentsRelations:()=>N,recurringExpenses:()=>m,recurringExpensesRelations:()=>L,users:()=>u,usersRelations:()=>y});var s=t(87106),n=t(53586),o=t(5795),a=t(54341),i=t(81347);let d=(0,s.Px)("groups",{id:(0,n.fL)("id").primaryKey(),name:(0,n.fL)("name").notNull(),ownerId:(0,n.fL)("owner_id").notNull(),createdAt:(0,o._L)("created_at",{mode:"timestamp"}).$defaultFn(()=>new Date),updatedAt:(0,o._L)("updated_at",{mode:"timestamp"}).$defaultFn(()=>new Date)}),u=(0,s.Px)("users",{id:(0,n.fL)("id").primaryKey(),name:(0,n.fL)("name"),email:(0,n.fL)("email").notNull().unique(),image:(0,n.fL)("image"),password:(0,n.fL)("password"),provider:(0,n.fL)("provider").notNull().default("credentials"),createdAt:(0,o._L)("created_at",{mode:"timestamp"}).$defaultFn(()=>new Date)}),l=(0,s.Px)("group_members",{id:(0,n.fL)("id").primaryKey(),groupId:(0,n.fL)("group_id").notNull().references(()=>d.id,{onDelete:"cascade"}),userId:(0,n.fL)("user_id").references(()=>u.id,{onDelete:"set null"}),name:(0,n.fL)("name").notNull(),quotaPercent:(0,a.kw)("quota_percent").notNull().default(0),createdAt:(0,o._L)("created_at",{mode:"timestamp"}).$defaultFn(()=>new Date)}),p=(0,s.Px)("expense_categories",{id:(0,n.fL)("id").primaryKey(),groupId:(0,n.fL)("group_id").notNull().references(()=>d.id,{onDelete:"cascade"}),name:(0,n.fL)("name").notNull(),icon:(0,n.fL)("icon").notNull().default("Folder"),color:(0,n.fL)("color").notNull().default("#6b7280"),createdAt:(0,o._L)("created_at",{mode:"timestamp"}).$defaultFn(()=>new Date)}),m=(0,s.Px)("recurring_expenses",{id:(0,n.fL)("id").primaryKey(),groupId:(0,n.fL)("group_id").notNull().references(()=>d.id,{onDelete:"cascade"}),categoryId:(0,n.fL)("category_id").references(()=>p.id,{onDelete:"set null"}),name:(0,n.fL)("name").notNull(),amount:(0,a.kw)("amount").notNull(),frequencyType:(0,n.fL)("frequency_type").notNull(),frequencyValue:(0,o._L)("frequency_value").notNull().default(1),dayOfMonth:(0,o._L)("day_of_month"),isActive:(0,o._L)("is_active",{mode:"boolean"}).notNull().default(!0),startMonth:(0,o._L)("start_month"),startYear:(0,o._L)("start_year"),endMonth:(0,o._L)("end_month"),endYear:(0,o._L)("end_year"),createdAt:(0,o._L)("created_at",{mode:"timestamp"}).$defaultFn(()=>new Date),updatedAt:(0,o._L)("updated_at",{mode:"timestamp"}).$defaultFn(()=>new Date)}),c=(0,s.Px)("one_time_expenses",{id:(0,n.fL)("id").primaryKey(),groupId:(0,n.fL)("group_id").notNull().references(()=>d.id,{onDelete:"cascade"}),expenseId:(0,n.fL)("expense_id").references(()=>m.id,{onDelete:"set null"}),categoryId:(0,n.fL)("category_id").references(()=>p.id,{onDelete:"set null"}),name:(0,n.fL)("name").notNull(),amount:(0,a.kw)("amount").notNull(),date:(0,o._L)("date",{mode:"timestamp"}).notNull(),month:(0,o._L)("month").notNull(),year:(0,o._L)("year").notNull(),isPaid:(0,o._L)("is_paid",{mode:"boolean"}).notNull().default(!1),createdAt:(0,o._L)("created_at",{mode:"timestamp"}).$defaultFn(()=>new Date)}),f=(0,s.Px)("expense_payments",{id:(0,n.fL)("id").primaryKey(),groupId:(0,n.fL)("group_id").notNull().references(()=>d.id,{onDelete:"cascade"}),expenseId:(0,n.fL)("expense_id").notNull().references(()=>m.id,{onDelete:"cascade"}),month:(0,o._L)("month").notNull(),year:(0,o._L)("year").notNull(),amount:(0,a.kw)("amount").notNull(),paidAt:(0,o._L)("paid_at",{mode:"timestamp"}).$defaultFn(()=>new Date)}),g=(0,s.Px)("payments",{id:(0,n.fL)("id").primaryKey(),groupId:(0,n.fL)("group_id").notNull().references(()=>d.id,{onDelete:"cascade"}),memberId:(0,n.fL)("member_id").notNull().references(()=>l.id,{onDelete:"cascade"}),expenseId:(0,n.fL)("expense_id").references(()=>m.id,{onDelete:"set null"}),month:(0,o._L)("month").notNull(),year:(0,o._L)("year").notNull(),amountPaid:(0,a.kw)("amount_paid").notNull(),isConfirmed:(0,o._L)("is_confirmed",{mode:"boolean"}).notNull().default(!1),confirmedAt:(0,o._L)("confirmed_at",{mode:"timestamp"}),createdAt:(0,o._L)("created_at",{mode:"timestamp"}).$defaultFn(()=>new Date)}),x=(0,i.lE)(d,({many:e})=>({members:e(l),categories:e(p),expenses:e(m),oneTimeExpenses:e(c),payments:e(g),expensePayments:e(f)})),y=(0,i.lE)(u,({many:e})=>({groupMembers:e(l)})),_=(0,i.lE)(l,({one:e,many:r})=>({group:e(d,{fields:[l.groupId],references:[d.id]}),payments:r(g)})),w=(0,i.lE)(p,({one:e,many:r})=>({group:e(d,{fields:[p.groupId],references:[d.id]}),expenses:r(m),oneTimeExpenses:r(c)})),L=(0,i.lE)(m,({one:e,many:r})=>({group:e(d,{fields:[m.groupId],references:[d.id]}),category:e(p,{fields:[m.categoryId],references:[p.id]}),payments:r(g),expensePayments:r(f)})),b=(0,i.lE)(c,({one:e})=>({group:e(d,{fields:[c.groupId],references:[d.id]}),expense:e(m,{fields:[c.expenseId],references:[m.id]}),category:e(p,{fields:[c.categoryId],references:[p.id]})})),h=(0,i.lE)(f,({one:e})=>({group:e(d,{fields:[f.groupId],references:[d.id]}),expense:e(m,{fields:[f.expenseId],references:[m.id]})})),N=(0,i.lE)(g,({one:e})=>({group:e(d,{fields:[g.groupId],references:[d.id]}),member:e(l,{fields:[g.memberId],references:[l.id]}),expense:e(m,{fields:[g.expenseId],references:[m.id]})}))},95456:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.d(r,{L:()=>p});var n=t(53797),o=t(77234),a=t(90469),i=t(63737),d=t(57745),u=t(98691),l=e([a]);a=(l.then?(await l)():l)[0];let p={providers:[(0,o.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET}),(0,n.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let[r]=await a.db.select().from(i.users).where((0,d.eq)(i.users.email,e.email)).limit(1);return r&&r.password&&await (0,u.qu)(e.password,r.password)?{id:r.id,email:r.email,name:r.name,image:r.image}:null}})],callbacks:{jwt:async({token:e,user:r})=>(r&&(e.id=r.id),e),async signIn({user:e,account:r}){if(r?.provider==="google"){let[r]=await a.db.select().from(i.users).where((0,d.eq)(i.users.email,e.email)).limit(1);r||await a.db.insert(i.users).values({id:e.id,name:e.name,email:e.email,image:e.image,provider:"google"})}return!0},session:async({session:e,token:r})=>(e.user&&(e.user.id=r.id),e)},pages:{signIn:"/"},session:{strategy:"jwt"},secret:process.env.NEXTAUTH_SECRET};s()}catch(e){s(e)}})},46335:(e,r,t)=>{t.d(r,{Z:()=>d});let s=require("node:crypto"),n={randomUUID:s.randomUUID},o=new Uint8Array(256),a=o.length,i=[];for(let e=0;e<256;++e)i.push((e+256).toString(16).slice(1));let d=function(e,r,t){return!n.randomUUID||r||e?function(e,r,t){let n=(e=e||{}).random??e.rng?.()??(a>o.length-16&&((0,s.randomFillSync)(o),a=0),o.slice(a,a+=16));if(n.length<16)throw Error("Random bytes length must be >= 16");if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,r){if((t=t||0)<0||t+16>r.length)throw RangeError(`UUID byte range ${t}:${t+15} is out of buffer bounds`);for(let e=0;e<16;++e)r[t+e]=n[e];return r}return function(e,r=0){return(i[e[r+0]]+i[e[r+1]]+i[e[r+2]]+i[e[r+3]]+"-"+i[e[r+4]]+i[e[r+5]]+"-"+i[e[r+6]]+i[e[r+7]]+"-"+i[e[r+8]]+i[e[r+9]]+"-"+i[e[r+10]]+i[e[r+11]]+i[e[r+12]]+i[e[r+13]]+i[e[r+14]]+i[e[r+15]]).toLowerCase()}(n)}(e,r,t):n.randomUUID()}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[276,422,70,734],()=>t(72712));module.exports=s})();