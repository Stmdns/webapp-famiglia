"use strict";(()=>{var e={};e.id=752,e.ids=[752],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},84629:e=>{e.exports=import("@libsql/client")},20723:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>u,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>c,staticGenerationAsyncStorage:()=>m});var s=t(49303),a=t(88716),o=t(60670),i=t(61788),d=e([i]);i=(d.then?(await d)():d)[0];let l=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/groups/[id]/one-time-expenses/route",pathname:"/api/groups/[id]/one-time-expenses",filename:"route",bundlePath:"app/api/groups/[id]/one-time-expenses/route"},resolvedPagePath:"C:\\Users\\denis\\famiglia-budget\\src\\app\\api\\groups\\[id]\\one-time-expenses\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:c}=l,f="/api/groups/[id]/one-time-expenses/route";function u(){return(0,o.patchFetch)({serverHooks:c,staticGenerationAsyncStorage:m})}n()}catch(e){n(e)}})},61788:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.r(r),t.d(r,{DELETE:()=>g,GET:()=>m,POST:()=>c,PUT:()=>f});var s=t(87070),a=t(75571),o=t(90469),i=t(63737),d=t(57745),u=t(46335),l=t(95456),p=e([o,l]);async function m(e,{params:r}){try{let t=await (0,a.getServerSession)(l.L);if(!t?.user?.id)return s.NextResponse.json({error:"Unauthorized"},{status:401});let{id:n}=await r,{searchParams:u}=new URL(e.url),p=parseInt(u.get("month")||String(new Date().getMonth()+1)),m=parseInt(u.get("year")||String(new Date().getFullYear())),[c]=await o.db.select().from(i.groups).innerJoin(i.groupMembers,(0,d.xD)((0,d.eq)(i.groups.id,i.groupMembers.groupId),(0,d.eq)(i.groupMembers.userId,t.user.id))).where((0,d.eq)(i.groups.id,n)).limit(1);if(!c)return s.NextResponse.json({error:"Group not found"},{status:404});let f=await o.db.select().from(i.oneTimeExpenses).where((0,d.xD)((0,d.eq)(i.oneTimeExpenses.groupId,n),(0,d.eq)(i.oneTimeExpenses.month,p),(0,d.eq)(i.oneTimeExpenses.year,m))),g=await o.db.select().from(i.expenseCategories).where((0,d.eq)(i.expenseCategories.groupId,n)),x=f.map(e=>({...e,category:g.find(r=>r.id===e.categoryId)}));return s.NextResponse.json(x)}catch(e){return console.error("Error fetching one-time expenses:",e),s.NextResponse.json({error:"Internal error"},{status:500})}}async function c(e,{params:r}){try{let t=await (0,a.getServerSession)(l.L);if(!t?.user?.id)return s.NextResponse.json({error:"Unauthorized"},{status:401});let{id:n}=await r,{name:p,amount:m,categoryId:c,date:f,month:g,year:x,expenseId:y}=await e.json();if(!p||!m||!f||!g||!x)return s.NextResponse.json({error:"Name, amount, date, month and year required"},{status:400});let[w]=await o.db.select().from(i.groups).where((0,d.eq)(i.groups.id,n)).limit(1);if(!w||w.ownerId!==t.user.id)return s.NextResponse.json({error:"Forbidden"},{status:403});let _=(0,u.Z)(),L=new Date;return await o.db.insert(i.oneTimeExpenses).values({id:_,groupId:n,expenseId:y||null,categoryId:c||null,name:p,amount:parseFloat(m),date:new Date(f),month:parseInt(g),year:parseInt(x),isPaid:!1,createdAt:L}),s.NextResponse.json({id:_,name:p,amount:m,month:g,year:x})}catch(e){return console.error("Error creating one-time expense:",e),s.NextResponse.json({error:"Internal error"},{status:500})}}async function f(e,{params:r}){try{let t=await (0,a.getServerSession)(l.L);if(!t?.user?.id)return s.NextResponse.json({error:"Unauthorized"},{status:401});let{id:n}=await r,{expenseId:u,name:p,amount:m,categoryId:c,date:f,month:g,year:x,isPaid:y}=await e.json(),[w]=await o.db.select().from(i.groups).where((0,d.eq)(i.groups.id,n)).limit(1);if(!w||w.ownerId!==t.user.id)return s.NextResponse.json({error:"Forbidden"},{status:403});return await o.db.update(i.oneTimeExpenses).set({name:p,amount:parseFloat(m),categoryId:c||null,date:new Date(f),month:parseInt(g),year:parseInt(x),isPaid:void 0!==y&&y}).where((0,d.eq)(i.oneTimeExpenses.id,u)),s.NextResponse.json({success:!0})}catch(e){return console.error("Error updating one-time expense:",e),s.NextResponse.json({error:"Internal error"},{status:500})}}async function g(e,{params:r}){try{let t=await (0,a.getServerSession)(l.L);if(!t?.user?.id)return s.NextResponse.json({error:"Unauthorized"},{status:401});let{id:n}=await r,{searchParams:u}=new URL(e.url),p=u.get("expenseId"),[m]=await o.db.select().from(i.groups).where((0,d.eq)(i.groups.id,n)).limit(1);if(!m||m.ownerId!==t.user.id)return s.NextResponse.json({error:"Forbidden"},{status:403});return await o.db.delete(i.oneTimeExpenses).where((0,d.eq)(i.oneTimeExpenses.id,p)),s.NextResponse.json({success:!0})}catch(e){return console.error("Error deleting one-time expense:",e),s.NextResponse.json({error:"Internal error"},{status:500})}}[o,l]=p.then?(await p)():p,n()}catch(e){n(e)}})},90469:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.d(r,{db:()=>u});var s=t(84629),a=t(3122),o=t(63737),i=e([s,a]);[s,a]=i.then?(await i)():i;let d=(0,s.createClient)({url:process.env.TURSO_DATABASE_URL,authToken:process.env.TURSO_AUTH_TOKEN}),u=(0,a.t)(d,{schema:o});n()}catch(e){n(e)}})},63737:(e,r,t)=>{t.r(r),t.d(r,{expenseCategories:()=>p,expenseCategoriesRelations:()=>_,expensePayments:()=>f,expensePaymentsRelations:()=>I,groupMembers:()=>l,groupMembersRelations:()=>w,groups:()=>d,groupsRelations:()=>x,oneTimeExpenses:()=>c,oneTimeExpensesRelations:()=>h,payments:()=>g,paymentsRelations:()=>N,recurringExpenses:()=>m,recurringExpensesRelations:()=>L,users:()=>u,usersRelations:()=>y});var n=t(87106),s=t(53586),a=t(5795),o=t(54341),i=t(81347);let d=(0,n.Px)("groups",{id:(0,s.fL)("id").primaryKey(),name:(0,s.fL)("name").notNull(),ownerId:(0,s.fL)("owner_id").notNull(),createdAt:(0,a._L)("created_at",{mode:"timestamp"}).$defaultFn(()=>new Date),updatedAt:(0,a._L)("updated_at",{mode:"timestamp"}).$defaultFn(()=>new Date)}),u=(0,n.Px)("users",{id:(0,s.fL)("id").primaryKey(),name:(0,s.fL)("name"),email:(0,s.fL)("email").notNull().unique(),image:(0,s.fL)("image"),password:(0,s.fL)("password"),provider:(0,s.fL)("provider").notNull().default("credentials"),createdAt:(0,a._L)("created_at",{mode:"timestamp"}).$defaultFn(()=>new Date)}),l=(0,n.Px)("group_members",{id:(0,s.fL)("id").primaryKey(),groupId:(0,s.fL)("group_id").notNull().references(()=>d.id,{onDelete:"cascade"}),userId:(0,s.fL)("user_id").references(()=>u.id,{onDelete:"set null"}),name:(0,s.fL)("name").notNull(),quotaPercent:(0,o.kw)("quota_percent").notNull().default(0),createdAt:(0,a._L)("created_at",{mode:"timestamp"}).$defaultFn(()=>new Date)}),p=(0,n.Px)("expense_categories",{id:(0,s.fL)("id").primaryKey(),groupId:(0,s.fL)("group_id").notNull().references(()=>d.id,{onDelete:"cascade"}),name:(0,s.fL)("name").notNull(),icon:(0,s.fL)("icon").notNull().default("Folder"),color:(0,s.fL)("color").notNull().default("#6b7280"),createdAt:(0,a._L)("created_at",{mode:"timestamp"}).$defaultFn(()=>new Date)}),m=(0,n.Px)("recurring_expenses",{id:(0,s.fL)("id").primaryKey(),groupId:(0,s.fL)("group_id").notNull().references(()=>d.id,{onDelete:"cascade"}),categoryId:(0,s.fL)("category_id").references(()=>p.id,{onDelete:"set null"}),name:(0,s.fL)("name").notNull(),amount:(0,o.kw)("amount").notNull(),frequencyType:(0,s.fL)("frequency_type").notNull(),frequencyValue:(0,a._L)("frequency_value").notNull().default(1),dayOfMonth:(0,a._L)("day_of_month"),isActive:(0,a._L)("is_active",{mode:"boolean"}).notNull().default(!0),startMonth:(0,a._L)("start_month"),startYear:(0,a._L)("start_year"),endMonth:(0,a._L)("end_month"),endYear:(0,a._L)("end_year"),createdAt:(0,a._L)("created_at",{mode:"timestamp"}).$defaultFn(()=>new Date),updatedAt:(0,a._L)("updated_at",{mode:"timestamp"}).$defaultFn(()=>new Date)}),c=(0,n.Px)("one_time_expenses",{id:(0,s.fL)("id").primaryKey(),groupId:(0,s.fL)("group_id").notNull().references(()=>d.id,{onDelete:"cascade"}),expenseId:(0,s.fL)("expense_id").references(()=>m.id,{onDelete:"set null"}),categoryId:(0,s.fL)("category_id").references(()=>p.id,{onDelete:"set null"}),name:(0,s.fL)("name").notNull(),amount:(0,o.kw)("amount").notNull(),date:(0,a._L)("date",{mode:"timestamp"}).notNull(),month:(0,a._L)("month").notNull(),year:(0,a._L)("year").notNull(),isPaid:(0,a._L)("is_paid",{mode:"boolean"}).notNull().default(!1),createdAt:(0,a._L)("created_at",{mode:"timestamp"}).$defaultFn(()=>new Date)}),f=(0,n.Px)("expense_payments",{id:(0,s.fL)("id").primaryKey(),groupId:(0,s.fL)("group_id").notNull().references(()=>d.id,{onDelete:"cascade"}),expenseId:(0,s.fL)("expense_id").notNull().references(()=>m.id,{onDelete:"cascade"}),month:(0,a._L)("month").notNull(),year:(0,a._L)("year").notNull(),amount:(0,o.kw)("amount").notNull(),paidAt:(0,a._L)("paid_at",{mode:"timestamp"}).$defaultFn(()=>new Date)}),g=(0,n.Px)("payments",{id:(0,s.fL)("id").primaryKey(),groupId:(0,s.fL)("group_id").notNull().references(()=>d.id,{onDelete:"cascade"}),memberId:(0,s.fL)("member_id").notNull().references(()=>l.id,{onDelete:"cascade"}),expenseId:(0,s.fL)("expense_id").references(()=>m.id,{onDelete:"set null"}),month:(0,a._L)("month").notNull(),year:(0,a._L)("year").notNull(),amountPaid:(0,o.kw)("amount_paid").notNull(),isConfirmed:(0,a._L)("is_confirmed",{mode:"boolean"}).notNull().default(!1),confirmedAt:(0,a._L)("confirmed_at",{mode:"timestamp"}),createdAt:(0,a._L)("created_at",{mode:"timestamp"}).$defaultFn(()=>new Date)}),x=(0,i.lE)(d,({many:e})=>({members:e(l),categories:e(p),expenses:e(m),oneTimeExpenses:e(c),payments:e(g),expensePayments:e(f)})),y=(0,i.lE)(u,({many:e})=>({groupMembers:e(l)})),w=(0,i.lE)(l,({one:e,many:r})=>({group:e(d,{fields:[l.groupId],references:[d.id]}),payments:r(g)})),_=(0,i.lE)(p,({one:e,many:r})=>({group:e(d,{fields:[p.groupId],references:[d.id]}),expenses:r(m),oneTimeExpenses:r(c)})),L=(0,i.lE)(m,({one:e,many:r})=>({group:e(d,{fields:[m.groupId],references:[d.id]}),category:e(p,{fields:[m.categoryId],references:[p.id]}),payments:r(g),expensePayments:r(f)})),h=(0,i.lE)(c,({one:e})=>({group:e(d,{fields:[c.groupId],references:[d.id]}),expense:e(m,{fields:[c.expenseId],references:[m.id]}),category:e(p,{fields:[c.categoryId],references:[p.id]})})),I=(0,i.lE)(f,({one:e})=>({group:e(d,{fields:[f.groupId],references:[d.id]}),expense:e(m,{fields:[f.expenseId],references:[m.id]})})),N=(0,i.lE)(g,({one:e})=>({group:e(d,{fields:[g.groupId],references:[d.id]}),member:e(l,{fields:[g.memberId],references:[l.id]}),expense:e(m,{fields:[g.expenseId],references:[m.id]})}))},95456:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.d(r,{L:()=>p});var s=t(53797),a=t(77234),o=t(90469),i=t(63737),d=t(57745),u=t(98691),l=e([o]);o=(l.then?(await l)():l)[0];let p={providers:[(0,a.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET}),(0,s.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let[r]=await o.db.select().from(i.users).where((0,d.eq)(i.users.email,e.email)).limit(1);return r&&r.password&&await (0,u.qu)(e.password,r.password)?{id:r.id,email:r.email,name:r.name,image:r.image}:null}})],callbacks:{jwt:async({token:e,user:r})=>(r&&(e.id=r.id),e),async signIn({user:e,account:r}){if(r?.provider==="google"){let[r]=await o.db.select().from(i.users).where((0,d.eq)(i.users.email,e.email)).limit(1);r||await o.db.insert(i.users).values({id:e.id,name:e.name,email:e.email,image:e.image,provider:"google"})}return!0},session:async({session:e,token:r})=>(e.user&&(e.user.id=r.id),e)},pages:{signIn:"/"},session:{strategy:"jwt"},secret:process.env.NEXTAUTH_SECRET};n()}catch(e){n(e)}})},46335:(e,r,t)=>{t.d(r,{Z:()=>d});let n=require("node:crypto"),s={randomUUID:n.randomUUID},a=new Uint8Array(256),o=a.length,i=[];for(let e=0;e<256;++e)i.push((e+256).toString(16).slice(1));let d=function(e,r,t){return!s.randomUUID||r||e?function(e,r,t){let s=(e=e||{}).random??e.rng?.()??(o>a.length-16&&((0,n.randomFillSync)(a),o=0),a.slice(o,o+=16));if(s.length<16)throw Error("Random bytes length must be >= 16");if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,r){if((t=t||0)<0||t+16>r.length)throw RangeError(`UUID byte range ${t}:${t+15} is out of buffer bounds`);for(let e=0;e<16;++e)r[t+e]=s[e];return r}return function(e,r=0){return(i[e[r+0]]+i[e[r+1]]+i[e[r+2]]+i[e[r+3]]+"-"+i[e[r+4]]+i[e[r+5]]+"-"+i[e[r+6]]+i[e[r+7]]+"-"+i[e[r+8]]+i[e[r+9]]+"-"+i[e[r+10]]+i[e[r+11]]+i[e[r+12]]+i[e[r+13]]+i[e[r+14]]+i[e[r+15]]).toLowerCase()}(s)}(e,r,t):s.randomUUID()}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[276,422,70,734],()=>t(20723));module.exports=n})();