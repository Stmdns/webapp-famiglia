(()=>{var e={};e.id=620,e.ids=[620],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},77630:(e,s,a)=>{"use strict";a.r(s),a.d(s,{GlobalError:()=>n.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>c,routeModule:()=>u,tree:()=>d}),a(11129),a(10826),a(7629),a(35866);var t=a(23191),r=a(88716),i=a(37922),n=a.n(i),l=a(95231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);a.d(s,o);let d=["",{children:["groups",{children:["[id]",{children:["expenses",{children:["one-time",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,11129)),"C:\\Users\\denis\\famiglia-budget\\src\\app\\groups\\[id]\\expenses\\one-time\\page.tsx"]}]},{}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,10826)),"C:\\Users\\denis\\famiglia-budget\\src\\app\\layout.tsx"],error:[()=>Promise.resolve().then(a.bind(a,7629)),"C:\\Users\\denis\\famiglia-budget\\src\\app\\error.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,35866,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\denis\\famiglia-budget\\src\\app\\groups\\[id]\\expenses\\one-time\\page.tsx"],m="/groups/[id]/expenses/one-time/page",x={require:a,loadChunk:()=>Promise.resolve()},u=new t.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/groups/[id]/expenses/one-time/page",pathname:"/groups/[id]/expenses/one-time",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},25215:(e,s,a)=>{Promise.resolve().then(a.bind(a,74814))},74814:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>C});var t=a(10326),r=a(77109),i=a(35047),n=a(17577),l=a(29752),o=a(91664),d=a(41190),c=a(44794),m=a(73326),x=a(24118),u=a(29280),h=a(86934),p=a(85999),g=a(86333),j=a(95964),f=a(83855),v=a(37358),b=a(32933),N=a(71821),y=a(94019),w=a(44389),P=a(98091),S=a(90434);function C(){let{data:e,status:s}=(0,r.useSession)();(0,i.useRouter)();let a=(0,i.useParams)().id,[C,k]=(0,n.useState)([]),[A,I]=(0,n.useState)([]),[z,_]=(0,n.useState)([]),[q,E]=(0,n.useState)(!0),[Z,$]=(0,n.useState)(!1),[D,O]=(0,n.useState)(null),[T,F]=(0,n.useState)(""),[M,U]=(0,n.useState)(""),[V,G]=(0,n.useState)(""),[Y,R]=(0,n.useState)(""),[B,J]=(0,n.useState)(""),[L,Q]=(0,n.useState)(""),[W,X]=(0,n.useState)(""),[K,H]=(0,n.useState)(""),ee=new Date().getMonth()+1,es=new Date().getFullYear(),ea=e=>e?z.filter(s=>s.categoryId===e&&s.isActive).reduce((e,s)=>e+function(e){switch(e.frequencyType){case"weekly":return 4.33*e.amount;case"monthly":default:return e.amount;case"yearly":return e.amount/12;case"days":return e.amount*(30/e.frequencyValue);case"months":return e.amount/e.frequencyValue}}(s),0):0,et=e=>{O(e.id),F(e.name),U(e.amount.toString()),G(e.categoryId||""),R(e.date.split("T")[0])},er=()=>{O(null),F(""),U(""),G(""),R("")},ei=async e=>{try{if((await fetch(`/api/groups/${a}/one-time-expenses`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({expenseId:e,name:T,amount:M,categoryId:V||null,date:Y,month:ee,year:es,isPaid:C.find(s=>s.id===e)?.isPaid??!1})})).ok){let s=C.map(s=>{if(s.id===e){let e=A.find(e=>e.id===(V||null));return{...s,name:T,amount:parseFloat(M),categoryId:V||null,date:Y,category:e}}return s});k(s),er(),p.Am.success("Spesa aggiornata!")}else p.Am.error("Errore nell'aggiornamento")}catch(e){p.Am.error("Errore")}},en=async(e,s)=>{let t=C.find(s=>s.id===e);if(t)try{(await fetch(`/api/groups/${a}/one-time-expenses`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({expenseId:e,name:t.name,amount:t.amount,categoryId:t.categoryId,date:t.date,month:t.month,year:t.year,isPaid:!s})})).ok&&(k(C.map(a=>a.id===e?{...a,isPaid:!s}:a)),p.Am.success(s?"Segnata come non pagata":"Segnata come pagata!"))}catch(e){p.Am.error("Errore")}},el=async e=>{if(e.preventDefault(),B.trim()&&L&&K)try{let e=await fetch(`/api/groups/${a}/one-time-expenses`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:B,amount:L,categoryId:W||null,date:K,month:ee,year:es})});if(e.ok){let s=await e.json(),a=A.find(e=>e.id===(W||null));k([...C,{...s,date:K,month:ee,year:es,isPaid:!1,category:a}]),$(!1),ed(),p.Am.success("Spesa aggiunta!")}else p.Am.error("Errore nell'aggiunta")}catch(e){p.Am.error("Errore")}},eo=async e=>{if(confirm("Sei sicuro di voler eliminare questa spesa?"))try{(await fetch(`/api/groups/${a}/one-time-expenses?expenseId=${e}`,{method:"DELETE"})).ok&&(k(C.filter(s=>s.id!==e)),p.Am.success("Spesa eliminata"))}catch(e){p.Am.error("Errore")}},ed=()=>{J(""),Q(""),X(""),H("")},ec=C.reduce((e,s)=>e+s.amount,0),em=C.filter(e=>e.isPaid).reduce((e,s)=>e+s.amount,0),ex=ec-em,eu=(()=>{let e={};return C.forEach(s=>{let a=s.categoryId||"uncategorized";e[a]||(e[a]=[]),e[a].push(s)}),e})();return q||"loading"===s?t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsx("div",{className:"animate-pulse text-slate-400",children:"Caricamento..."})}):(0,t.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-100",children:[t.jsx("header",{className:"bg-white border-b border-slate-200 px-6 py-4 sticky top-0 z-10",children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[t.jsx(S.default,{href:`/groups/${a}`,children:t.jsx(o.z,{variant:"ghost",size:"icon",children:t.jsx(g.Z,{className:"w-4 h-4"})})}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-600 rounded-xl flex items-center justify-center",children:t.jsx(j.Z,{className:"w-5 h-5 text-white"})}),(0,t.jsxs)("div",{children:[t.jsx("h1",{className:"text-xl font-bold text-slate-900",children:"Spese Singole"}),(0,t.jsxs)("p",{className:"text-xs text-slate-500",children:[["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"][ee-1]," ",es]})]})]})]}),(0,t.jsxs)(x.Vq,{open:Z,onOpenChange:$,children:[t.jsx(x.hg,{asChild:!0,children:(0,t.jsxs)(o.z,{className:"bg-slate-900 hover:bg-slate-800",children:[t.jsx(f.Z,{className:"w-4 h-4 mr-2"}),"Aggiungi spesa"]})}),(0,t.jsxs)(x.cZ,{children:[t.jsx(x.fK,{children:t.jsx(x.$N,{children:"Aggiungi spesa singola"})}),(0,t.jsxs)("form",{onSubmit:el,className:"space-y-4 mt-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(c._,{children:"Descrizione"}),t.jsx(d.I,{placeholder:"Es. Spesa al supermercato",value:B,onChange:e=>J(e.target.value),required:!0})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(c._,{children:"Importo"}),t.jsx(d.I,{type:"number",step:"0.01",min:"0",placeholder:"0.00",value:L,onChange:e=>Q(e.target.value),required:!0})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(c._,{children:"Categoria"}),(0,t.jsxs)(u.Ph,{value:W,onValueChange:X,children:[t.jsx(u.i4,{children:t.jsx(u.ki,{placeholder:"Seleziona categoria"})}),t.jsx(u.Bw,{children:A.map(e=>t.jsx(u.Ql,{value:e.id,children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),e.name]})},e.id))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(c._,{children:"Data"}),t.jsx(d.I,{type:"date",value:K,onChange:e=>H(e.target.value),required:!0})]}),t.jsx(o.z,{type:"submit",className:"w-full",children:"Aggiungi"})]})]})]})]})}),(0,t.jsxs)("main",{className:"max-w-4xl mx-auto p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,t.jsxs)(l.Zb,{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white border-0",children:[t.jsx(l.Ol,{className:"pb-2",children:(0,t.jsxs)(l.ll,{className:"text-sm font-medium text-blue-100 flex items-center gap-2",children:[t.jsx(v.Z,{className:"w-4 h-4"}),"Totale Mensile"]})}),(0,t.jsxs)(l.aY,{children:[(0,t.jsxs)("div",{className:"text-2xl font-bold",children:["€ ",ec.toFixed(2)]}),(0,t.jsxs)("p",{className:"text-xs text-blue-100 mt-1",children:[C.length," spese"]})]})]}),(0,t.jsxs)(l.Zb,{className:"bg-gradient-to-br from-green-500 to-green-600 text-white border-0",children:[t.jsx(l.Ol,{className:"pb-2",children:(0,t.jsxs)(l.ll,{className:"text-sm font-medium text-green-100 flex items-center gap-2",children:[t.jsx(b.Z,{className:"w-4 h-4"}),"Pagato"]})}),(0,t.jsxs)(l.aY,{children:[(0,t.jsxs)("div",{className:"text-2xl font-bold",children:["€ ",em.toFixed(2)]}),t.jsx("p",{className:"text-xs text-green-100 mt-1",children:"questo mese"})]})]}),(0,t.jsxs)(l.Zb,{className:`bg-gradient-to-br ${ex>=0?"from-amber-500 to-amber-600":"from-green-500 to-green-600"} text-white border-0`,children:[t.jsx(l.Ol,{className:"pb-2",children:(0,t.jsxs)(l.ll,{className:"text-sm font-medium text-amber-100 flex items-center gap-2",children:[t.jsx(N.Z,{className:"w-4 h-4"}),ex>=0?"Da Pagare":"Surplus"]})}),(0,t.jsxs)(l.aY,{children:[(0,t.jsxs)("div",{className:"text-2xl font-bold",children:["€ ",Math.abs(ex).toFixed(2)]}),t.jsx("p",{className:"text-xs text-amber-100 mt-1",children:ex>=0?"rimanente":"accantonato"})]})]})]}),Object.entries(eu).map(([e,s])=>{let a=A.find(s=>s.id===e),r=a?.name||"Altro",i=a?.color||"#6b7280",n=ea("uncategorized"===e?null:e),c=s.reduce((e,s)=>e+s.amount,0);return(0,t.jsxs)(l.Zb,{children:[(0,t.jsxs)(l.Ol,{className:"pb-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:i}}),t.jsx(l.ll,{className:"text-lg",children:r})]}),n>0&&(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("p",{className:"text-sm font-medium",children:["Budget: €",n.toFixed(2)]}),(0,t.jsxs)("p",{className:`text-xs ${c>n?"text-red-500":"text-slate-500"}`,children:["Speso: €",c.toFixed(2)]})]})]}),n>0&&t.jsx(h.E,{value:n>0?Math.min(c/n*100,100):0,className:"h-2",style:{backgroundColor:"#e2e8f0"}})]}),t.jsx(l.aY,{className:"space-y-2",children:s.map(e=>t.jsx("div",{className:`flex items-center justify-between p-2 rounded-lg ${e.isPaid?"bg-green-50":"bg-slate-50"}`,children:D===e.id?(0,t.jsxs)("div",{className:"flex items-center gap-3 w-full",children:[t.jsx(m.r,{checked:e.isPaid,onCheckedChange:()=>en(e.id,e.isPaid)}),(0,t.jsxs)("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-4 gap-2",children:[t.jsx(d.I,{value:T,onChange:e=>F(e.target.value),placeholder:"Descrizione"}),t.jsx(d.I,{type:"number",step:"0.01",value:M,onChange:e=>U(e.target.value),placeholder:"Importo"}),(0,t.jsxs)(u.Ph,{value:V,onValueChange:G,children:[t.jsx(u.i4,{children:t.jsx(u.ki,{placeholder:"Categoria"})}),t.jsx(u.Bw,{children:A.map(e=>t.jsx(u.Ql,{value:e.id,children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),e.name]})},e.id))})]}),t.jsx(d.I,{type:"date",value:Y,onChange:e=>R(e.target.value)})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[t.jsx(o.z,{variant:"ghost",size:"icon",className:"text-green-500 hover:text-green-700 hover:bg-green-50",onClick:()=>ei(e.id),children:t.jsx(b.Z,{className:"w-4 h-4"})}),t.jsx(o.z,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-700 hover:bg-red-50",onClick:er,children:t.jsx(y.Z,{className:"w-4 h-4"})})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[t.jsx(m.r,{checked:e.isPaid,onCheckedChange:()=>en(e.id,e.isPaid)}),(0,t.jsxs)("div",{children:[t.jsx("p",{className:"font-medium",children:e.name}),t.jsx("p",{className:"text-xs text-slate-500",children:new Date(e.date).toLocaleDateString("it-IT")})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("p",{className:"font-bold",children:["€ ",e.amount.toFixed(2)]}),t.jsx("p",{className:"text-xs text-slate-500",children:e.isPaid?"Pagato":"Da pagare"})]}),t.jsx(o.z,{variant:"ghost",size:"icon",className:"text-slate-400 hover:text-slate-600 hover:bg-slate-100",onClick:()=>et(e),children:t.jsx(w.Z,{className:"w-4 h-4"})}),t.jsx(o.z,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-700 hover:bg-red-50",onClick:()=>eo(e.id),children:t.jsx(P.Z,{className:"w-4 h-4"})})]})]})},e.id))})]},e)}),0===C.length&&t.jsx(l.Zb,{children:(0,t.jsxs)(l.aY,{className:"py-12 text-center",children:[t.jsx(j.Z,{className:"w-12 h-12 mx-auto text-slate-300 mb-4"}),t.jsx("p",{className:"text-slate-500",children:"Nessuna spesa singola questo mese"})]})})]})]})}},86934:(e,s,a)=>{"use strict";a.d(s,{E:()=>N});var t=a(10326),r=a(17577),i=a(93095),n=a(77335),l="Progress",[o,d]=(0,i.b)(l),[c,m]=o(l),x=r.forwardRef((e,s)=>{var a,r;let{__scopeProgress:i,value:l=null,max:o,getValueLabel:d=p,...m}=e;(o||0===o)&&!f(o)&&console.error((a=`${o}`,`Invalid prop \`max\` of value \`${a}\` supplied to \`Progress\`. Only numbers greater than 0 are valid max values. Defaulting to \`100\`.`));let x=f(o)?o:100;null===l||v(l,x)||console.error((r=`${l}`,`Invalid prop \`value\` of value \`${r}\` supplied to \`Progress\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or 100 if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`));let u=v(l,x)?l:null,h=j(u)?d(u,x):void 0;return(0,t.jsx)(c,{scope:i,value:u,max:x,children:(0,t.jsx)(n.WV.div,{"aria-valuemax":x,"aria-valuemin":0,"aria-valuenow":j(u)?u:void 0,"aria-valuetext":h,role:"progressbar","data-state":g(u,x),"data-value":u??void 0,"data-max":x,...m,ref:s})})});x.displayName=l;var u="ProgressIndicator",h=r.forwardRef((e,s)=>{let{__scopeProgress:a,...r}=e,i=m(u,a);return(0,t.jsx)(n.WV.div,{"data-state":g(i.value,i.max),"data-value":i.value??void 0,"data-max":i.max,...r,ref:s})});function p(e,s){return`${Math.round(e/s*100)}%`}function g(e,s){return null==e?"indeterminate":e===s?"complete":"loading"}function j(e){return"number"==typeof e}function f(e){return j(e)&&!isNaN(e)&&e>0}function v(e,s){return j(e)&&!isNaN(e)&&e<=s&&e>=0}h.displayName=u;var b=a(51223);function N({className:e,value:s,...a}){return t.jsx(x,{"data-slot":"progress",className:(0,b.cn)("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",e),...a,children:t.jsx(h,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})})}},11129:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>t});let t=(0,a(68570).createProxy)(String.raw`C:\Users\denis\famiglia-budget\src\app\groups\[id]\expenses\one-time\page.tsx#default`)}};var s=require("../../../../../webpack-runtime.js");s.C(e);var a=e=>s(s.s=e),t=s.X(0,[276,42,509,552,867,451,37,482],()=>a(77630));module.exports=t})();